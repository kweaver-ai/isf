# /bin/bash

#
# eacpserver 服务启动脚本。
# 参考svn://192.168.1.14/trunk/platform/DataEngine/EInfoworks/components/einfoworks
#

# Source function library
if [ -f /etc/init.d/functions ] ; then
  . /etc/init.d/functions
elif [ -f /etc/rc.d/init.d/functions ] ; then
  . /etc/rc.d/init.d/functions
else
  exit 1
fi

APPNAME=eacpdaemon

get_absolute_path_of_this_script ()
{
    ori=$1
    ori_dir=`pwd`
    if [ -h $ori ] ; then
        ori=$(readlink -f $ori)
    fi
    if [ $? = 1 ] ; then
        echo "readlink failed"
        exit 1
    fi

    cd $(dirname $ori)
    abs_path=`pwd`
    cd $ori_dir
}

get_absolute_path_of_this_script $0
cd $abs_path

if [ ! -e "$abs_path/../bin/$APPNAME" ]; then
    echo "$abs_path/../bin/$APPNAME does not exist."
    exit 1
fi

if [ ! -h eacpserverln ] ; then
    ln -sf ../bin/eacpserver1 eacpserverln
fi

status() {
    ./eacpserverln status
    RETVAL=$?

    if [ $RETVAL = '0' ] ; then
        RETVAL='0'
    else
        RETVAL='3'
    fi
    
    return $RETVAL
}

start() {
    ./eacpserverln start
}

stop() {
    ./eacpserverln stop
}

restart() {
    stop
    start
}

# See how we were called.
case "$1" in
    start)
        start
        RETVAL=$?
        ;;
    stop)
        stop
        RETVAL=$?
        ;;
    restart)
        restart
        RETVAL=$?
        ;;
    status)
        status
        RETVAL=$?
        ;;
    *)
        echo "Usage: $0 {start|stop|restart|status}"
        RETVAL=2
esac

exit $RETVAL
